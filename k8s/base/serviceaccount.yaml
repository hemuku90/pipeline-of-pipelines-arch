apiVersion: v1
kind: ServiceAccount
metadata:
  name: pipeline-arch
  labels:
    app: pipeline-arch
    version: v1.0.0
  annotations:
    description: "Service Account for Pipeline Architecture Application"
# ImagePullSecrets for private container registry
# imagePullSecrets:
#   - name: docker-registry-secret
---
# Role for minimal permissions within same namespace
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: pipeline-arch-role
  labels:
    app: pipeline-arch
    version: v1.0.0
  annotations:
    description: "Role with minimal permissions for application"
rules:
  # Allow reading configmaps and secrets for configuration
  - apiGroups: [""]
    resources: ["configmaps", "secrets"]
    verbs: ["get", "list", "watch"]
  # Allow endpoints for service discovery
  - apiGroups: [""]
    resources: ["endpoints", "services"]
    verbs: ["get", "list", "watch"]
  # Allow pods logs for debugging (read-only)
  - apiGroups: [""]
    resources: ["pods/log"]
    verbs: ["get", "list"]
---
# RoleBinding to bind Role to ServiceAccount
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: pipeline-arch-rolebinding
  labels:
    app: pipeline-arch
    version: v1.0.0
  annotations:
    description: "Binds application ServiceAccount to Role"
subjects:
  - kind: ServiceAccount
    name: pipeline-arch
    namespace: ""  # Will be set by deployment namespace
roleRef:
  kind: Role
  name: pipeline-arch-role
  apiGroup: rbac.authorization.k8s.io
---
# Optional: ClusterRole for cross-namespace or cluster-wide access
# apiVersion: rbac.authorization.k8s.io/v1
# kind: ClusterRole
# metadata:
#   name: pipeline-arch-clusterrole
#   labels:
#     app: pipeline-arch
# rules:
#   # For metrics-server integration if needed
#   - apiGroups: ["metrics.k8s.io"]
#     resources: ["pods"]
#     verbs: ["get", "list"]
# ---
# ClusterRoleBinding for cluster-wide permissions
# apiVersion: rbac.authorization.k8s.io/v1
# kind: ClusterRoleBinding
# metadata:
#   name: pipeline-arch-clusterrolebinding
# subjects:
#   - kind: ServiceAccount
#     name: pipeline-arch
#     namespace: app
# roleRef:
#   kind: ClusterRole
#   name: pipeline-arch-clusterrole
#   apiGroup: rbac.authorization.k8s.io